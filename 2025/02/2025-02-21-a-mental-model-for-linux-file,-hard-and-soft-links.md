# A mental model for Linux file, hard and soft links
- URL: https://bhoot.dev/2024/on-linux-file-and-links/
- Added At: 2025-02-21 02:46:20
- [Link To Text](2025-02-21-a-mental-model-for-linux-file,-hard-and-soft-links_raw.md)

## Summary
**摘要**：
本文旨在构建一个简化的 Linux 文件、硬链接和软链接的心智模型。在存储层面，文件是数据块。在文件系统层面，数据块由 inode 表示，inode 存储关于底层数据块的元数据。路径名则使得 inode 和数据块的组合对用户可用。文件可被视为 路径名 + inode + 数据块。硬链接是将不同的路径名指向同一个 inode，所有硬链接具有同等地位，删除其中一个不影响其他链接，只有当所有硬链接都被删除时，inode 和数据块才会被标记为删除。软链接则不同，它创建一个指向目标文件的链接文件，软链接文件有自己的 inode 和数据块，其内容是目标文件的路径名。复制软链接文件默认会复制目标文件，移动软链接文件会更新路径名但保持指向目标文件不变。如果目标文件被删除，软链接会变成死链接。硬链接是路径名到 inode 的链接，而软链接是链接文件到目标文件的链接。

**要点总结**：

1.  **Linux 文件组成：** 文件在 Linux 中由三个关键部分组成：数据块（实际存储的数据）、inode（存储数据块的元数据）和路径名（用户访问文件的接口）。可以将文件理解为“路径名 + inode + 数据块”的组合。
2.  **硬链接的本质：** 硬链接可以被理解为给同一个 `inode`（数据块的代表）贴上不同的标签（路径名）。这意味着多个路径名指向同一个 `inode`，所有通过硬链接访问该`inode`都是等效的。删除任何一个硬链接，只要还存在其他指向该`inode`的硬链接，文件内容仍然可以被访问。只有当指向特定 `inode` 的所有硬链接都被删除时，系统才会真正删除该文件及其数据块。
3.  **软链接的特性：** 软链接（也称为符号链接）是一种特殊的文件类型，它包含指向另一个文件或目录的路径名。与硬链接不同，软链接拥有自己的 `inode` 和数据块，其数据块中存储的是目标文件的路径。因此删除软链接本身不会影响目标文件，但如果目标文件被移动或删除，软链接将变成“断链”。
4.  **软链接的文件操作：** 复制软链接文件时，默认情况下，`cp` 命令会复制软链接指向的目标文件，而不是软链接本身。而移动软链接文件时，只有软链接的路径名会改变，它仍然指向原来的目标文件。

