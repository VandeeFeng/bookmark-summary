# Better Shell History Search
- URL: https://tratt.net/laurie/blog/2025/better_shell_history_search.html
- Added At: 2025-03-26 05:14:31
- [Link To Text](2025-03-26-better-shell-history-search_raw.md)

## Summary
**摘要**：
文章主要讲述了如何通过优化shell历史搜索来提高Unix终端的工作效率。作者首先提到，在Unix终端中使用shell命令是日常工作的重要部分，但不同用户之间的效率差异巨大。为了提高效率，作者介绍了使用`Ctrl-r`结合`fzf`或`skim`进行模糊匹配搜索shell历史的方法，这极大地提高了命令查找的效率，甚至改变了作者使用shell命令的习惯，例如，现在作者更倾向于在单个命令中设置环境变量，而不是设置全局环境变量。作者详细讲解了如何通过修改zsh的配置，使得在通过`Ctrl-r`搜索历史命令时，显示命令的执行时间距离现在的时间差，而不是默认的无意义的整数。作者通过修改`.zshrc`文件，并结合`awk`命令对时间戳进行处理，最终实现了在历史命令中显示相对时间的功能。作者强调，即使是很小的优化，也能为长期在Unix终端工作的用户带来显著的效率提升。

**要点总结**：
1.  **使用`Ctrl-r`结合`fzf`或`skim`进行模糊匹配搜索shell历史可以显著提高效率**：`fzf`和`skim` 允许用户通过模糊输入快速找到并执行以前使用过的命令，避免了记忆复杂命令和参数的麻烦，极大地提高了在 Unix shell 中的生产力。
2.  **可以通过配置zsh记录命令执行时间**：通过在`~/.zshrc`中设置`EXTENDED_HISTORY`和`inc_append_history_time`，zsh能够记录每个命令执行的时间戳和执行时长, 为后续的时间差显示提供数据基础。
3.  **修改zsh配置和fzf/skim的UI可以显示更有用的命令历史信息**：通过自定义`history-widget`函数，可以改变`Ctrl-r`的默认行为，显示命令执行时间距离现在的时间差，而不是默认的整数ID，使得用户能更快速地定位到需要的命令。
4.  **使用`awk`处理时间戳，计算时间差**：`awk`是一个在Unix系统中用于处理文本的强大工具，文章利用`awk`将`fc`命令输出的时间戳转换为易于理解的时间差，如“1d”表示1天前，或具体的“hour:minute”，方便用户根据时间快速筛选命令。

