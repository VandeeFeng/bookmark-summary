# 高并发爬虫调优小记 - 从 1 QPS 到 10000 QPS
- URL: https://blog.lyc8503.net/post/high-performance-crawler/
- Added At: 2024-11-24 07:39:53
- [Link To Text](2024-11-24-高并发爬虫调优小记---从-1-qps-到-10000-qps_raw.md)

## Summary
**摘要**：
本文详细记录了一次从原始爬虫的低并发QPS优化至10,000 QPS的经历。作者通过实践和调整，最终解决了高频API访问的困扰，优化了爬虫性能，并成功使用IPv6避开IP频控限制。

**要点总结**：
1. **初始问题识别与多线程实现**：开始时，爬虫QPS仅为个位数。引入多线程功能后，虽然能够并发请求，但在短时间内因频繁遭受403、429、400、412等状态码的响应和跳转验证而挂掉。原因在于访问频控触发了限流机制。

2. **IPv6资源应用与策略选择**：作者发现部分网站限制较宽松仅按照/128或更细粒度进行限制，而家庭宽带的/64相当宽松。最终选择将爬虫流量代理至本地消息极小的IPv6地址，以绕过IP访问限制。同时，活跃使用Xray代理增大代理池饱和度，有效缓解代理服务器用量。

3. **性能调优：异步优化**：通过将异步操作接入，如使用`aiohttp`与`asyncio`，显著提升了爬取性能，线路程数到40多后性能表现依旧稳定。这意味着，每完成一轮请求后，通过结束进行中的任务，系统能够预留出线程资源以服务于下一批请求，形成有效的线程流转。

4. **性能瓶颈与并发战术优化**：发现了连接数限制成为瓶颈，通过临时提升系统配置参数，重新关注不同请求集成于单个客户端会话以减少全局连接数，进而减少资源消耗，提高系统效率。

5. **并行进程与API带宽探索**：在保证响应时间和系统稳定性的前提下，最大化并发数量，利用多进程实现并行处理，甚至达到同时满足1万离峰请求的性能。作者通过实践探索了丰富的性能与环境配置，最终形成规模和效率的优化模型，实质上研究了爬虫设计在并发、连接复用和调度策略上的挑战与解答。

注意，文章作者采取了多种策略和工具调整来最大化系统性能并尽量减轻资源消耗，包括IPv6的巧妙使用、异步编程技术的应用、适当的代理管理和多进程的调度。整个过程展示了高并发环境下优化爬虫策略的复杂度与实现路径，对理解现代网络环境下的分布式和资源调配有着重要启示。
