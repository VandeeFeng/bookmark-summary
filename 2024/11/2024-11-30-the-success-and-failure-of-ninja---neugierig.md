# The Success and Failure of Ninja - neugierig
- URL: https://neugierig.org/software/blog/2020/05/ninja.html
- Added At: 2024-11-30 05:24:47
- [Link To Text](2024-11-30-the-success-and-failure-of-ninja---neugierig_raw.md)

## Summary
**摘要**：
九年前，我发布了一个名为 Ninja 的构建系统，其功能与 Make 相似。尽管我最初对分享这个副项目有些尴尬，但 Ninja 后来变得非常流行。若非详尽列举所有用户，一些大型项目使用了 Ninja，例如：
- Chrome，最终移除了所有非-Ninja 构建；
- Android，使用了它的一部分系统，但具体部分我并未完全了解；
- 所有 Meson 项目的使用，这些似乎是自由软件领域的首选构建系统；
- 许多使用 Ninja 和 CMake 的项目，例如 Swift 语言的构建指南指出，要安装 Ninja。Ninja 被视为我最成功的开源项目，无论按照何种衡量标准。我在 2011 年发布 Ninja，2014 年移交了所有权，并在后来被转交给第三位维护者。回顾这段经历，我学到了不少：
- 技术问题往往以解决代码问题为主，但实质上或多或少与之无关。初、高级工程师的转型之路对此有着深刻的阐述。
- 技术：
  - Ninja 的主要功能很简单，由合格的系统课程大学生也能凭直觉构建类似系统。它接受一个包含所有命令、文件消耗和产生的`ninja.build`文件，检查文件的修改时间，并并行执行必要的命令更新。
  - 技术侧重于优化速度，采用各种精心设计但小规模的优化。Ninja 导入文件路径到一个唯一的内存对象，用于进行路径相等性测试（类似内建字符串）。
- 架构设计：
  - Ninja 使用二部图来表示构建结构，文件节点与命令节点之间互相引用。这种表示清晰地勾勒了构建的结构，其中任意命令的输入改变都将导致其更新所有输出。
- CMake 集成：
  - Ninja 与 CMake 的集成主要由 Peter Collingbourne 完成，Peter 对使 Ninja 成功于现实世界中贡献了主要力量，尽管我在支持这一整合中表现不佳。
- Windows 支持：
  - 悉心提供了 Windows 版本，当时推动该项目的Google 产品（Chrome）需要 Windows 社区的用户群支持。Windows 是开发者的主要平台之一，在这里，一个项目一旦能得到 Windows 开发者的使用，总会吸引大量的关注。
- 相关工作：
  - 在构建系统领域中，Ninja 的设计并非建立在深厚的研究基础上。论文“Build Systems à la Carte”讨论了增量计算问题，尽管它发布时间早于 Ninja。

**要点总结**：
1. **技术背景**：
   - Ninja 的功能有限，但足够高效，重点在于速度而不是工具集的丰富性，适用于大规模项目（如 >100k 输入文件）。
   - 使用二部图表示构建过程，使指挥命令更新的逻辑得以清晰呈现，文件和命令节点间相互关联。
2. **设计决策**：
   - Ninja 设计特色如文件路径的**唯一内存对象映射**和路径相等地检测（类似内建字符串），以优化执行速度。
3. **CMake 集成贡献**：
   - Ninja 与 CMake 的集成大部分由 Peter Collingbourne 完成，成为了 Ninja 成功的关键一步。
4. **Windows 支持的背景**：
   - Ninja 得以支持 Windows 的原因在于它为开发者社区提供了周到的工具，尤其是对于那些渴求工具但往往选择付费软件的 Windows 开发者群。
5. **开源维护者的心路历程**：
   - 作为一名开源维护者，作者体验了一种复杂情感交织的经历，包括骄傲、失望、挫败和对理想社区的期待，同时也反思了作为开源项目的创作动机的变化。
